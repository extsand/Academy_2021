pipeline {
    agent any
		// agent {
		// 	label: python
		// }
    
    environment {
        PROJECT = "Simple.app"
        DESCRIPTIONS = "GitHub -> Jenkins -> AWS"
        OWNER = "extsand"
        GIT_REPO = "https://github.com/extsand/Simple.app"
        AWS_INSTANCE = "http://18.159.124.211"
     
        
    }

    stages {
        stage('Introducting') {
            steps {
                echo "Hello Users"
                echo "It is ${PROJECT} project "
                echo "We use pipeline ${DESCRIPTIONS}"
             
                
            }
        }
        stage('Clone Git Repository'){
            steps {
                echo "Get app files from ${GIT_REPO}"
                git branch: 'main', 
                credentialsId: 'extsand_git_credentials', 
                url: 'git@github.com:extsand/Simple.app.git'
            }
        }
        stage('Publish over SSH') {
            steps {
                sshPublisher(
                    publishers: [
                        sshPublisherDesc(
                            configName: 'AWS_18.159.124.211', 
                            transfers: [
                                sshTransfer(
                                    cleanRemote: false, 
                                    excludes: '', 
                                    execCommand: 'sudo service httpd restart', 
                                    execTimeout: 120000, 
                                    flatten: false, 
                                    makeEmptyDirs: false, 
                                    noDefaultExcludes: false, 
                                    patternSeparator: '[, ]+', 
                                    remoteDirectory: '', 
                                    remoteDirectorySDF: false, 
                                    removePrefix: '', 
                                    sourceFiles: '**'
                                    )
                            ], 
                            usePromotionTimestamp: false, 
                            useWorkspaceInPromotion: false, 
                            verbose: false
                        )
                    ]
                )
            }
        }
        stage('Complete deploy'){
            steps{
                echo "Deploy was complete"
                echo "${AWS_INSTANCE}"
            }
        }
        stage('Notification to Telegram'){
            steps{
                telegramSend(
                    message: 'Build is Done! Look at ${AWS_INSTANCE}',
                    chatId: 340034025
                )
            }
        }
    }
    post {
        success {
            echo '=====================DEPLOY SUCCESS==================='
            telegramSend(message: 'From Jenkins')
        }
    }
}